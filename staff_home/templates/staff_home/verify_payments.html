{% extends "staff_home/base.html" %}

{% block extra_styles %}
<style>
.team-card {
  background: rgba(255, 255, 255, 0.05);
  padding: 1rem;
  margin-bottom: 1rem;
  border-radius: 12px;
  color: #fff;
}

.container {
  background: rgba(255, 255, 255, 0.05) !important;
  padding: 1rem !important;
  margin-bottom: 1rem !important;
  border-radius: 12px !important;
  color: #fff !important;
}

.modal {
  display: none;
  position: fixed;
  z-index: 1000;
  padding-top: 60px;
  left: 0; top: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.9);
}

.modal-content {
  display: block;
  margin: auto;
  max-width: 80%;
  border-radius: 10px;
}

.close {
  position: absolute;
  top: 20px; right: 35px;
  font-size: 40px;
  color: #fff;
  cursor: pointer;
}
</style>
{% endblock %}

{% block content %}
<div class="container">
    <h2>Payment Verification</h2>

    <!-- Filters -->
    <form method="get">
        <input type="text" name="q" placeholder="Search team/leader" value="{{ query }}">
        <select name="status">
            <option value="">All</option>
            <option value="pending" {% if status_filter == "pending" %}selected{% endif %}>Pending</option>
            <option value="verified" {% if status_filter == "verified" %}selected{% endif %}>Verified</option>
            <option value="rejected" {% if status_filter == "rejected" %}selected{% endif %}>Rejected</option>
        </select>
        <button type="submit">Apply</button>
    </form>

    <hr>

    {% if teams %}
        {% for team in teams %}
            <div class="team-card">
                <h3>{{ team.name }}</h3>
                <p><strong>Leader:</strong> {{ team.leader.email }}</p>
                <p><strong>Members:</strong>
                  {% for member in team.members.all %}
                    {{ member.email }}{% if not forloop.last %}, {% endif %}
                  {% endfor %}
                </p>

                <p><strong>Ref No:</strong> {{ team.payment_ref|default_if_none:"N/A" }}</p>

                {% if team.payment_screenshot %}
                    <button type="button" onclick="openModal('{{ team.payment_screenshot.url }}')">
                        üì∑ View Screenshot
                    </button>
                {% else %}
                    <p>No screenshot uploaded</p>
                {% endif %}

                <p>
                  Status:
                  {% if team.is_paid and team.is_verified %}
                    ‚úÖ Verified
                  {% elif team.is_paid and not team.is_verified %}
                    ‚è≥ Pending
                  {% else %}
                    ‚ùå Not Paid
                  {% endif %}
                </p>
            </div>
        {% endfor %}
    {% else %}
        <p>No teams found.</p>
    {% endif %}
</div>

<!-- Modal -->
<div id="screenshotModal" class="modal">
  <span class="close" onclick="closeModal()">&times;</span>
  <img class="modal-content" id="modalImage">
</div>

<script>
function openModal(src) {
  document.getElementById("screenshotModal").style.display = "block";
  document.getElementById("modalImage").src = src;
}
function closeModal() {
  document.getElementById("screenshotModal").style.display = "none";
}
</script>
{% endblock %}
