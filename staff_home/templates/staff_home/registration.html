{% extends "staff_home/dashboard.html" %}

{% block title %}Registration Check{% endblock %}

{% block content %}
<div class="container">
  <h2>Registered Teams</h2>

  <!-- Search + Filters -->
  <form method="get" class="filter-form mb-3">
    <input type="text" name="q" value="{{ query }}" placeholder="Search by team/leader" class="form-control mb-2">

    <select name="paid" class="form-select mb-2">
      <option value="">Filter by Paid</option>
      <option value="yes" {% if filter_paid == "yes" %}selected{% endif %}>Paid</option>
      <option value="no" {% if filter_paid == "no" %}selected{% endif %}>Not Paid</option>
    </select>

    <select name="verified" class="form-select mb-2">
      <option value="">Filter by Verified</option>
      <option value="yes" {% if filter_verified == "yes" %}selected{% endif %}>Verified</option>
      <option value="no" {% if filter_verified == "no" %}selected{% endif %}>Not Verified</option>
    </select>

    <select name="outsider" class="form-select mb-2">
      <option value="">Filter by Outsider</option>
      <option value="yes" {% if filter_outsider == "yes" %}selected{% endif %}>Outsiders Only</option>
      <option value="no" {% if filter_outsider == "no" %}selected{% endif %}>Only NITK</option>
    </select>

    <button type="submit" class="btn btn-primary">Apply</button>
  </form>

  <!-- Teams List -->
  {% for team in page_obj %}
    <div class="card my-3 p-3">
      <h4>{{ team.name }}</h4>
      <p><b>Leader:</b> {{ team.leader.username }} ({{ team.leader.email }})</p>
      <p><b>Paid:</b> {{ team.is_paid }}</p>
      <p><b>Verified:</b> {{ team.is_verified }}</p>
      <p><b>Outsider:</b> {{ team.is_outsider }}</p>
      <p><b>Members:</b>
        {% for member in team.members.all %}
          {{ member.username }} ({{ member.email }})
          {% if member.profile %}[{{ member.profile.college }}]{% endif %}
          {% if not forloop.last %}, {% endif %}
        {% empty %}
          No members yet
        {% endfor %}
      </p>
      {% if team.payment_screenshot %}
        <p><b>Payment Screenshot:</b></p>
        <img src="{{ team.payment_screenshot.url }}" style="max-height:200px;">
      {% endif %}
      {% if team.payment_ref %}
        <p><b>Payment Ref:</b> {{ team.payment_ref }}</p>
      {% endif %}
    </div>
  {% empty %}
    <p>No teams found.</p>
  {% endfor %}

  <!-- Pagination -->
  <div class="pagination mt-3">
    {% if page_obj.has_previous %}
      <a class="btn btn-secondary" href="?page={{ page_obj.previous_page_number }}&q={{ query }}&paid={{ filter_paid }}&verified={{ filter_verified }}&outsider={{ filter_outsider }}">Previous</a>
    {% endif %}
    <span class="mx-2">Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>
    {% if page_obj.has_next %}
      <a class="btn btn-secondary" href="?page={{ page_obj.next_page_number }}&q={{ query }}&paid={{ filter_paid }}&verified={{ filter_verified }}&outsider={{ filter_outsider }}">Next</a>
    {% endif %}
  </div>
</div>
{% endblock %}
