{% extends "staff_home/base.html" %}

{% block content %}
<div class="container mt-4 text-white">
  <h2 class="mb-4">Manage Resources</h2>

  <!-- Upload/Edit Form -->
  <div class="card bg-dark border-light mb-4">
    <div class="card-body">
      {% if edit_id %}
        <h5 class="card-title">Edit Resource</h5>
      {% else %}
        <h5 class="card-title">Upload New Resource</h5>
      {% endif %}
      <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        {{ form.as_p }}
        <button type="submit" class="btn btn-primary">
          {% if edit_id %}Save Changes{% else %}Upload{% endif %}
        </button>
        {% if edit_id %}
          <a href="{% url 'manage_resources' %}" class="btn btn-secondary">Cancel</a>
        {% endif %}
      </form>
    </div>
  </div>

  <!-- Uploaded Resources -->
  <div class="card bg-dark border-light">
    <div class="card-body">
      <h5 class="card-title">Uploaded Resources</h5>
      {% if resources %}
        <div class="table-responsive">
          <table class="table table-dark table-striped align-middle">
            <thead>
              <tr>
                <th>Title</th>
                <th>File</th>
                <th>Link</th>
                <th class="text-center">Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for r in resources %}
                <tr>
                  <td>{{ r.title }}</td>
                  <td>
                    {% if r.file %}
                      <a href="{{ r.file.url }}" target="_blank" class="text-info">ðŸ“„ View</a>
                    {% else %}
                      <span class="text-muted">â€”</span>
                    {% endif %}
                  </td>
                  <td>
                    {% if r.link %}
                      <a href="{{ r.link }}" target="_blank" class="text-warning">ðŸ”— Visit</a>
                    {% else %}
                      <span class="text-muted">â€”</span>
                    {% endif %}
                  </td>
                  <td class="text-center">
                    <!-- Edit just reloads page with ?edit=ID -->
                    <a href="{% url 'manage_resources' %}?edit={{ r.id }}" 
                       class="btn btn-sm btn-warning me-2">Edit</a>

                    <!-- Delete posts with hidden delete_id -->
                    <form method="post" action="{% url 'manage_resources' %}" 
                          style="display:inline;" 
                          onsubmit="return confirm('Are you sure you want to delete this resource?');">
                      {% csrf_token %}
                      <input type="hidden" name="delete_id" value="{{ r.id }}">
                      <button type="submit" class="btn btn-sm btn-danger">Delete</button>
                    </form>
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% else %}
        <p class="text-muted">No resources yet.</p>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
